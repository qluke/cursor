---
title: ä»é›¶å¼€å‘ MCP æœåŠ¡å™¨  
description: mcp-server-from-scratch è¯´æ˜
---

# MCP æœåŠ¡å™¨å¼€å‘åè®®

æœ¬åè®®æ—¨åœ¨è§„èŒƒå’Œç®€åŒ–ä½¿ç”¨ Cline æ„å»º MCP æœåŠ¡å™¨çš„å¼€å‘æµç¨‹ã€‚

> ğŸš€ **æ„å»ºå¹¶åˆ†äº«ä½ çš„ MCP æœåŠ¡å™¨ã€‚** å½“ä½ å®Œæˆä¸€ä¸ªä¼˜ç§€çš„ MCP æœåŠ¡å™¨åï¼Œæ¬¢è¿æäº¤åˆ° [Cline MCP å¸‚åœº](https://github.com/cline/mcp-marketplace)ï¼Œè®©æˆåƒä¸Šä¸‡çš„å¼€å‘è€…ä¸€é”®å‘ç°å’Œå®‰è£…ã€‚

---

## ä»€ä¹ˆæ˜¯ MCP æœåŠ¡å™¨ï¼Ÿ

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰æœåŠ¡å™¨ä¸º Cline ç­‰ AI åŠ©æ‰‹æ‰©å±•èƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿï¼š

- è®¿é—®å¤–éƒ¨ API å’ŒæœåŠ¡
- è·å–å®æ—¶æ•°æ®
- æ§åˆ¶åº”ç”¨å’Œæœ¬åœ°ç³»ç»Ÿ
- æ‰§è¡Œæ–‡æœ¬æç¤ºæ— æ³•å®Œæˆçš„æ“ä½œ

æ²¡æœ‰ MCPï¼ŒAI åŠ©æ‰‹è™½å¼ºå¤§ä½†å­¤ç«‹ï¼›æœ‰äº† MCPï¼Œå®ƒä»¬å¯ä»¥ä¸å‡ ä¹æ‰€æœ‰æ•°å­—ç³»ç»Ÿäº¤äº’ã€‚

---

## å¼€å‘åè®®

é«˜æ•ˆå¼€å‘ MCP æœåŠ¡å™¨çš„æ ¸å¿ƒåœ¨äºéµå¾ªç»“æ„åŒ–åè®®ã€‚è¯¥åè®®é€šè¿‡ `.clinerules` æ–‡ä»¶å®ç°ï¼Œéœ€æ”¾åœ¨ MCP å·¥ä½œç›®å½•ï¼ˆå¦‚ `/Users/your-name/Documents/Cline/MCP`ï¼‰æ ¹ç›®å½•ä¸‹ã€‚

### ä½¿ç”¨ `.clinerules` æ–‡ä»¶

`.clinerules` æ˜¯ Cline è‡ªåŠ¨è¯»å–çš„ç‰¹æ®Šé…ç½®æ–‡ä»¶ï¼Œä½œç”¨åŒ…æ‹¬ï¼š

- é…ç½® Cline è¡Œä¸ºï¼Œå¼ºåˆ¶æœ€ä½³å®è·µ
- åˆ‡æ¢ Cline è‡³ä¸“ç”¨ MCP å¼€å‘æ¨¡å¼
- æä¾›åˆ†æ­¥å¼€å‘åè®®
- å®ç°å®‰å…¨æªæ–½ï¼ˆå¦‚é˜²æ­¢æœªæµ‹è¯•æå‰å®Œæˆï¼‰
- æŒ‡å¯¼ä½ å®Œæˆè§„åˆ’ã€å®ç°ã€æµ‹è¯•ç­‰é˜¶æ®µ

**å®Œæ•´ MCP æœåŠ¡å™¨å¼€å‘åè®®ï¼ˆåº”æ”¾å…¥ `.clinerules` æ–‡ä»¶ï¼‰ï¼š**

```md
# MCP æœåŠ¡å™¨å¼€å‘åè®®
âš ï¸ é‡è¦ï¼šæœªæµ‹è¯•å‰ç¦æ­¢ä½¿ç”¨ attempt_completion

## æ­¥éª¤ 1ï¼šè§„åˆ’ï¼ˆPLAN MODEï¼‰
- è¯¥å·¥å…·è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- å°†ä½¿ç”¨å“ªä¸ª API/æœåŠ¡ï¼Ÿ
- è®¤è¯éœ€æ±‚ï¼Ÿ
  â–¡ æ ‡å‡† API key
  â–¡ OAuthï¼ˆéœ€å•ç‹¬è„šæœ¬ï¼‰
  â–¡ å…¶ä»–å‡­è¯

## æ­¥éª¤ 2ï¼šå®ç°ï¼ˆACT MODEï¼‰
1. åˆå§‹åŒ–
   - Web æœåŠ¡/JS/Node.js ç¯å¢ƒï¼š
     ```bash
     npx @modelcontextprotocol/create-server my-server
     cd my-server
     npm install
     ```
   - æ•°æ®ç§‘å­¦/ML/Python ç¯å¢ƒï¼š
     ```bash
     pip install mcp
     # æˆ–æ¨èç”¨ uv
     uv add "mcp[cli]"
     ```
2. æ ¸å¿ƒå®ç°
   - ä½¿ç”¨ MCP SDK
   - å®ç°å…¨é¢æ—¥å¿—
   - TypeScript ç¤ºä¾‹ï¼š
     ```typescript
     console.error('[Setup] Initializing server...');
     console.error('[API] Request to endpoint:', endpoint);
     console.error('[Error] Failed with:', error);
     ```
   - Python ç¤ºä¾‹ï¼š
     ```python
     import logging
     logging.error('[Setup] Initializing server...')
     logging.error(f'[API] Request to endpoint: {endpoint}')
     logging.error(f'[Error] Failed with: {str(error)}')
     ```
   - æ·»åŠ ç±»å‹å®šä¹‰
   - é”™è¯¯å¤„ç†éœ€æœ‰ä¸Šä¸‹æ–‡
   - å¦‚éœ€é™æµï¼ŒåŠ¡å¿…å®ç°

3. é…ç½®
   - å¦‚éœ€å‡­è¯ï¼Œå‘ç”¨æˆ·è·å–
   - æ·»åŠ åˆ° MCP è®¾ç½®ï¼š
     - TypeScript é¡¹ç›®ï¼š
       ```json
       {
         "mcpServers": {
           "my-server": {
             "command": "node",
             "args": ["path/to/build/index.js"],
             "env": { "API_KEY": "key" },
             "disabled": false,
             "autoApprove": []
           }
         }
       }
       ```
     - Python é¡¹ç›®ï¼š
       ```bash
       # å‘½ä»¤è¡Œç›´æ¥å®‰è£…
       mcp install server.py -v API_KEY=key
       ```
       æˆ–åœ¨ settings.jsonï¼š
       ```json
       {
         "mcpServers": {
           "my-server": {
             "command": "python",
             "args": ["server.py"],
             "env": { "API_KEY": "key" },
             "disabled": false,
             "autoApprove": []
           }
         }
       }
       ```

## æ­¥éª¤ 3ï¼šæµ‹è¯•ï¼ˆBLOCKER â›”ï¸ï¼‰
<thinking>
ä½¿ç”¨ attempt_completion å‰ï¼Œå¿…é¡»ç¡®è®¤ï¼š
â–¡ æ˜¯å¦æµ‹è¯•äº†æ¯ä¸ªå·¥å…·ï¼Ÿ
â–¡ æ˜¯å¦æ¯é¡¹æµ‹è¯•éƒ½è·å¾—ç”¨æˆ·ç¡®è®¤ï¼Ÿ
â–¡ æ˜¯å¦è®°å½•äº†æµ‹è¯•ç»“æœï¼Ÿ
å¦‚æœ‰ä¸€é¡¹ä¸ºâ€œå¦â€ï¼Œç¦æ­¢ä½¿ç”¨ attempt_completionã€‚
</thinking>
1. æµ‹è¯•æ¯ä¸ªå·¥å…·ï¼ˆå¿…éœ€ï¼‰
   â–¡ ç”¨æœ‰æ•ˆè¾“å…¥æµ‹è¯•æ¯ä¸ªå·¥å…·
   â–¡ éªŒè¯è¾“å‡ºæ ¼å¼æ­£ç¡®
âš ï¸ æ‰€æœ‰å·¥å…·æœªæµ‹è¯•å‰ç¦æ­¢ç»§ç»­

## æ­¥éª¤ 4ï¼šå®Œæˆ
â— åœæ­¢å¹¶æ ¸æŸ¥ï¼š
â–¡ æ¯ä¸ªå·¥å…·å‡å·²ç”¨æœ‰æ•ˆè¾“å…¥æµ‹è¯•
â–¡ æ¯ä¸ªå·¥å…·è¾“å‡ºæ ¼å¼æ­£ç¡®
å…¨éƒ¨é€šè¿‡åæ–¹å¯ä½¿ç”¨ attempt_completion

## å…³é”®è¦æ±‚
- âœ“ å¿…é¡»ä½¿ç”¨ MCP SDK
- âœ“ å¿…é¡»æœ‰å…¨é¢æ—¥å¿—
- âœ“ å¿…é¡»å•ç‹¬æµ‹è¯•æ¯ä¸ªå·¥å…·
- âœ“ å¿…é¡»ä¼˜é›…å¤„ç†é”™è¯¯
- â›”ï¸ ç¦æ­¢è·³è¿‡æµ‹è¯•ç›´æ¥å®Œæˆ
```

å½“è¯¥ `.clinerules` æ–‡ä»¶å­˜åœ¨äºå·¥ä½œç›®å½•æ—¶ï¼ŒCline ä¼šï¼š

1. ä»¥ **PLAN MODE** å¯åŠ¨ï¼Œå…ˆè®¾è®¡æœåŠ¡å™¨
2. åœ¨ **ACT MODE** å¼ºåˆ¶è§„èŒƒå®ç°
3. è¦æ±‚æ‰€æœ‰å·¥å…·æµ‹è¯•é€šè¿‡åæ‰å…è®¸å®Œæˆ
4. å…¨ç¨‹å¼•å¯¼ä½ å®Œæˆå¼€å‘ç”Ÿå‘½å‘¨æœŸ

---

## å¿«é€Ÿå¼€å§‹

å¼€å‘ MCP æœåŠ¡å™¨åªéœ€å‡ ä¸ªç®€å•æ­¥éª¤ï¼š

### 1. åˆ›å»º `.clinerules` æ–‡ä»¶ï¼ˆğŸš¨ é‡è¦ï¼‰

é¦–å…ˆï¼Œå°†ä¸Šè¿°åè®®å†…å®¹ä¿å­˜ä¸º `.clinerules` æ–‡ä»¶ï¼Œæ”¾åœ¨ MCP å·¥ä½œç›®å½•æ ¹ç›®å½•ã€‚æ­¤æ–‡ä»¶ä¼šè®© Cline æŒ‰å¼€å‘åè®®å·¥ä½œã€‚

### 2. å‘èµ·æ¸…æ™°æè¿°çš„å¯¹è¯

åœ¨ Cline èŠå¤©ä¸­ï¼Œæ˜ç¡®æè¿°ä½ è¦æ„å»ºçš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š

- æœåŠ¡å™¨ç”¨é€”
- éœ€é›†æˆçš„ API æˆ–æœåŠ¡
- æ‰€éœ€å·¥å…·æˆ–åŠŸèƒ½

ç¤ºä¾‹ï¼š

```text
æˆ‘æƒ³ä¸º AlphaAdvantage é‡‘è API æ„å»ºä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œèƒ½è·å–å®æ—¶è‚¡ç¥¨æ•°æ®ã€åšæŠ€æœ¯åˆ†æã€æŸ¥è¯¢å…¬å¸è´¢æŠ¥ä¿¡æ¯ã€‚
```

### 3. æŒ‰åè®®æ¨è¿›

Cline ä¼šè‡ªåŠ¨è¿›å…¥ PLAN MODEï¼Œå¼•å¯¼ä½ ï¼š

- è®¨è®ºé—®é¢˜èŒƒå›´
- å®¡æŸ¥ API æ–‡æ¡£
- è§„åˆ’è®¤è¯æ–¹å¼
- è®¾è®¡å·¥å…·æ¥å£

å‡†å¤‡å¥½åï¼Œå¯åœ¨èŠå¤©åº•éƒ¨åˆ‡æ¢åˆ° ACT MODE å¼€å§‹å®ç°ã€‚

### 4. å°½æ—©æä¾› API æ–‡æ¡£

æœ€æœ‰æ•ˆçš„åšæ³•æ˜¯ï¼Œä¸€å¼€å§‹å°±å°†å®˜æ–¹ API æ–‡æ¡£å‘ç»™ Clineï¼š

```text
è¿™æ˜¯è¯¥æœåŠ¡çš„ API æ–‡æ¡£ï¼š[ç²˜è´´ API æ–‡æ¡£]
```

è¯¦ç»†çš„ API è¯´æ˜ï¼ˆç«¯ç‚¹ã€è®¤è¯ã€æ•°æ®ç»“æ„ï¼‰èƒ½æå¤§æå‡ Cline çš„å¼€å‘æ•ˆç‡ã€‚

---

## ç†è§£ä¸¤ç§æ¨¡å¼

### PLAN MODE

åœ¨æ­¤åä½œé˜¶æ®µï¼Œä½ ä¸ Cline å…±åŒè®¾è®¡ MCP æœåŠ¡å™¨ï¼š

- æ˜ç¡®é—®é¢˜èŒƒå›´
- é€‰æ‹©åˆé€‚ API
- è§„åˆ’è®¤è¯æ–¹å¼
- è®¾è®¡å·¥å…·æ¥å£
- ç¡®å®šæ•°æ®æ ¼å¼

### ACT MODE

è§„åˆ’å®Œæˆåï¼ŒCline ååŠ©ä½ å®ç°æœåŠ¡å™¨ï¼š

- æ­å»ºé¡¹ç›®ç»“æ„
- ç¼–å†™å®ç°ä»£ç 
- é…ç½®ç›¸å…³è®¾ç½®
- å½»åº•æµ‹è¯•æ¯ä¸ªç»„ä»¶
- å®Œå–„æ–‡æ¡£

---

## æ¡ˆä¾‹ï¼šAlphaAdvantage è‚¡ç¥¨åˆ†ææœåŠ¡å™¨

ä»¥ä¸‹æ˜¯ AlphaAdvantage MCP æœåŠ¡å™¨çš„å¼€å‘æµç¨‹ç¤ºä¾‹ï¼Œå…·å¤‡è‚¡ç¥¨æ•°æ®åˆ†æä¸æŠ¥å‘Šèƒ½åŠ›ã€‚

### è§„åˆ’é˜¶æ®µ

åœ¨è§„åˆ’é˜¶æ®µï¼Œæˆ‘ä»¬ï¼š

1. **å®šä¹‰é—®é¢˜**ï¼šç”¨æˆ·éœ€é€šè¿‡ AI åŠ©æ‰‹è·å–é‡‘èæ•°æ®ã€è‚¡ç¥¨åˆ†æå’Œå¸‚åœºæ´å¯Ÿ
2. **é€‰æ‹© API**ï¼šAlphaAdvantage é‡‘èå¸‚åœºæ•°æ® API
   - æ ‡å‡† API key è®¤è¯
   - å…è´¹ç‰ˆé™æµ 5 æ¬¡/åˆ†é’Ÿ
   - å¤šç§æ•°æ®ç«¯ç‚¹
3. **è®¾è®¡æ‰€éœ€å·¥å…·**ï¼š
   - è‚¡ç¥¨æ¦‚è§ˆï¼ˆå½“å‰ä»·æ ¼ã€å…¬å¸ä¿¡æ¯ï¼‰
   - æŠ€æœ¯åˆ†æï¼ˆRSIã€MACD ç­‰æŒ‡æ ‡ï¼‰
   - åŸºæœ¬é¢åˆ†æï¼ˆè´¢æŠ¥ã€æ¯”ç‡ï¼‰
   - ç›ˆåˆ©æŠ¥å‘Šæ•°æ®
   - æ–°é—»ä¸æƒ…ç»ªåˆ†æ
4. **è§„åˆ’æ•°æ®æ ¼å¼**ï¼š
   - å¹²å‡€ã€ç»“æ„åŒ–çš„ Markdown è¾“å‡º
   - è¡¨æ ¼å±•ç¤ºç»“æ„åŒ–æ•°æ®
   - è¶‹åŠ¿ç¬¦å·ï¼ˆâ†‘/â†“ï¼‰
   - è´¢åŠ¡æ•°å­—æ ¼å¼åŒ–

### å®ç°é˜¶æ®µ

æˆ‘ä»¬é¦–å…ˆåˆå§‹åŒ–é¡¹ç›®ï¼š

```bash
npx @modelcontextprotocol/create-server alphaadvantage-mcp
cd alphaadvantage-mcp
npm install axios node-cache
```

é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š

```text
src/
  â”œâ”€â”€ api/
  â”‚   â””â”€â”€ alphaAdvantageClient.ts   # API å®¢æˆ·ç«¯ï¼Œå«é™æµä¸ç¼“å­˜
  â”œâ”€â”€ formatters/
  â”‚   â””â”€â”€ markdownFormatter.ts      # Markdown æ ¼å¼åŒ–è¾“å‡º
  â””â”€â”€ index.ts                      # MCP æœåŠ¡å™¨ä¸»å®ç°
```

**API å®¢æˆ·ç«¯å®ç°è¦ç‚¹ï¼š**

- é™æµï¼šå¼ºåˆ¶ 5 æ¬¡/åˆ†é’Ÿ
- ç¼“å­˜ï¼šå‡å°‘ API è°ƒç”¨
- é”™è¯¯å¤„ç†ï¼šå¥å£®çš„å¼‚å¸¸æ£€æµ‹ä¸æŠ¥å‘Š
- ç±»å‹å®šä¹‰ï¼šæ‰€æœ‰æ•°æ®å‡æœ‰æ˜ç¡® TypeScript ç±»å‹

å…³é”®å®ç°ç‰‡æ®µï¼š

```typescript
/** ç®¡ç†å…è´¹ç‰ˆé™æµï¼ˆæ¯åˆ†é’Ÿ 5 æ¬¡ï¼‰ */
private async enforceRateLimit() {
  if (this.requestsThisMinute >= 5) {
    console.error("[Rate Limit] Rate limit reached. Waiting for next minute...");
    return new Promise<void>((resolve) => {
      const remainingMs = 60 * 1000 - (Date.now() % (60 * 1000));
      setTimeout(resolve, remainingMs + 100); // åŠ  100ms ç¼“å†²
    });
  }
  this.requestsThisMinute++;
  return Promise.resolve();
}
```

**Markdown æ ¼å¼åŒ–ç¤ºä¾‹ï¼š**

```typescript
/** å°†å…¬å¸æ¦‚è§ˆæ ¼å¼åŒ–ä¸º markdown */
export function formatStockOverview(overviewData: any, quoteData: any): string {
  // æå–æ•°æ®
  const overview = overviewData;
  const quote = quoteData["Global Quote"];
  // è®¡ç®—ä»·æ ¼å˜åŠ¨
  const currentPrice = parseFloat(quote["05. price"] || "0");
  const priceChange = parseFloat(quote["09. change"] || "0");
  const changePercent = parseFloat(quote["10. change percent"]?.replace("%", "") || "0");
  // æ ¼å¼åŒ– markdown
  let markdown = `# ${overview.Symbol} (${overview.Name}) - ${formatCurrency(currentPrice)} ${addTrendIndicator(priceChange)}${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%\n\n`;
  // æ›´å¤šç»†èŠ‚...
  return markdown;
}
```

**å·¥å…·å®ç°ç¤ºä¾‹ï¼š**

```typescript
server.setRequestHandler(ListToolsRequestSchema, async () => {
  console.error("[Setup] Listing available tools");
  return {
    tools: [
      {
        name: "get_stock_overview",
        description: "è·å–è‚¡ç¥¨ä»£ç çš„å…¬å¸ä¿¡æ¯å’Œå½“å‰æŠ¥ä»·",
        inputSchema: {
          type: "object",
          properties: {
            symbol: { type: "string", description: "è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 'AAPL')" },
            market: { type: "string", description: "å¯é€‰å¸‚åœºï¼ˆå¦‚ 'US')", default: "US" }
          },
          required: ["symbol"]
        }
      }
      // å…¶ä»–å·¥å…·...
    ]
  };
});
```

æ¯ä¸ªå·¥å…·çš„å¤„ç†å™¨éƒ½åŒ…å«ï¼š

- è¾“å…¥æ ¡éªŒ
- API å®¢æˆ·ç«¯è°ƒç”¨ä¸é”™è¯¯å¤„ç†
- Markdown æ ¼å¼åŒ–å“åº”
- å…¨é¢æ—¥å¿—

### æµ‹è¯•é˜¶æ®µ

æ­¤é˜¶æ®µéœ€ç³»ç»Ÿæ€§æµ‹è¯•æ¯ä¸ªå·¥å…·ï¼š

1. å…ˆåœ¨è®¾ç½®ä¸­é…ç½® MCP æœåŠ¡å™¨ï¼š

```json
{
  "mcpServers": {
    "alphaadvantage-mcp": {
      "command": "node",
      "args": ["/path/to/alphaadvantage-mcp/build/index.js"],
      "env": { "ALPHAVANTAGE_API_KEY": "YOUR_API_KEY" },
      "disabled": false,
      "autoApprove": []
    }
  }
}
```

2. é€ä¸€æµ‹è¯•æ¯ä¸ªå·¥å…·ï¼š

- **get_stock_overview**ï¼šè·å– AAPL è‚¡ç¥¨æ¦‚è§ˆ
  ```markdown
  # AAPL (Apple Inc) - $241.84 â†‘+1.91%
  **Sector:** TECHNOLOGY
  **Industry:** ELECTRONIC COMPUTERS
  **Market Cap:** 3.63T
  **P/E Ratio:** 38.26
  ...
  ```
- **get_technical_analysis**ï¼šè·å–ä»·æ ¼èµ°åŠ¿ä¸ RSI
  ```markdown
  # Technical Analysis: AAPL
  ## Daily Price Action
  Current Price: $241.84 (â†‘$4.54, +1.91%)
  ### Recent Daily Prices
  | Date | Open | High | Low | Close | Volume |
  |------|------|------|-----|-------|--------|
  | 2025-02-28 | $236.95 | $242.09 | $230.20 | $241.84 | 56.83M |
  ...
  ```
- **get_earnings_report**ï¼šè·å– MSFT ç›ˆåˆ©å†å²
  ```markdown
  # Earnings Report: MSFT (Microsoft Corporation)
  **Sector:** TECHNOLOGY
  **Industry:** SERVICES-PREPACKAGED SOFTWARE
  **Current EPS:** $12.43
  ## Recent Quarterly Earnings
  | Quarter | Date | EPS Estimate | EPS Actual | Surprise % |
  |---------|------|-------------|------------|------------|
  | 2024-12-31 | 2025-01-29 | $3.11 | $3.23 | â†‘4.01% |
  ...
  ```

### å¼€å‘ä¸­é‡åˆ°çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

1. **API é™æµ**
   - æŒ‘æˆ˜ï¼šå…è´¹ç‰ˆæ¯åˆ†é’Ÿä»… 5 æ¬¡
   - è§£å†³ï¼šå®ç°é˜Ÿåˆ—ã€å¼ºåˆ¶é™æµã€å¢åŠ ç¼“å­˜
2. **æ•°æ®æ ¼å¼åŒ–**
   - æŒ‘æˆ˜ï¼šAPI åŸå§‹æ•°æ®ä¸å‹å¥½
   - è§£å†³ï¼šè‡ªå®šä¹‰æ ¼å¼åŒ–å·¥å…·ï¼Œç»Ÿä¸€è¾“å‡º
3. **è¶…æ—¶é—®é¢˜**
   - æŒ‘æˆ˜ï¼šå¤æ‚å·¥å…·å¤šæ¬¡ API è°ƒç”¨æ˜“è¶…æ—¶
   - è§£å†³ï¼šå»ºè®®æ‹†åˆ†å·¥å…·ã€ä¼˜åŒ–ç¼“å­˜

### ç»éªŒæ€»ç»“

- è§„åˆ’ API é™æµç­–ç•¥
- æ™ºèƒ½ç¼“å­˜æå‡æ€§èƒ½
- æŠ•èµ„äºæ•°æ®æ ¼å¼åŒ–ï¼Œæå‡ä½“éªŒ
- æ¯ä¸ªå·¥å…·éƒ½è¦å•ç‹¬æµ‹è¯•
- å¤æ‚ API éœ€ç®€åŒ–å·¥å…·è®¾è®¡

---

## æ ¸å¿ƒå®ç°æœ€ä½³å®è·µ

### å…¨é¢æ—¥å¿—

æ—¥å¿—å¯¹è°ƒè¯• MCP æœåŠ¡å™¨è‡³å…³é‡è¦ï¼š

```typescript
// å¯åŠ¨æ—¥å¿—
console.error('[Setup] Initializing AlphaAdvantage MCP server...');
// API è¯·æ±‚æ—¥å¿—
console.error(`[API] Getting stock overview for ${symbol}`);
// é”™è¯¯å¤„ç†æ—¥å¿—
console.error(`[Error] Tool execution failed: ${error.message}`);
// ç¼“å­˜æ“ä½œæ—¥å¿—
console.error(`[Cache] Using cached data for: ${cacheKey}`);
```

### å¼ºç±»å‹å®šä¹‰

ç±»å‹å®šä¹‰å¯é˜²æ­¢é”™è¯¯å¹¶æå‡å¯ç»´æŠ¤æ€§ï¼š

```typescript
export interface AlphaAdvantageConfig {
  apiKey: string;
  cacheTTL?: Partial<typeof DEFAULT_CACHE_TTL>;
  baseURL?: string;
}

/** æ ¡éªŒè‚¡ç¥¨ä»£ç æœ‰æ•ˆæ€§ */
function validateSymbol(symbol: unknown): asserts symbol is string {
  if (typeof symbol !== "string" || symbol.trim() === "") {
    throw new McpError(ErrorCode.InvalidParams, "A valid stock symbol is required");
  }
  // åŸºæœ¬æ ¡éªŒ
  const symbolRegex = /^[A-Za-z0-9.]+$/;
  if (!symbolRegex.test(symbol)) {
    throw new McpError(ErrorCode.InvalidParams, `Invalid stock symbol: ${symbol}`);
  }
}
```

### æ™ºèƒ½ç¼“å­˜

å‡å°‘ API è°ƒç”¨ã€æå‡æ€§èƒ½ï¼š

```typescript
// é»˜è®¤ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
const DEFAULT_CACHE_TTL = {
  STOCK_OVERVIEW: 60 * 60, // 1å°æ—¶
  TECHNICAL_ANALYSIS: 60 * 30, // 30åˆ†é’Ÿ
  FUNDAMENTAL_ANALYSIS: 60 * 60 * 24, // 24å°æ—¶
  EARNINGS_REPORT: 60 * 60 * 24, // 24å°æ—¶
  NEWS: 60 * 15, // 15åˆ†é’Ÿ
};

// å…ˆæŸ¥ç¼“å­˜
const cachedData = this.cache.get<T>(cacheKey);
if (cachedData) {
  console.error(`[Cache] Using cached data for: ${cacheKey}`);
  return cachedData;
}

// ç¼“å­˜æˆåŠŸå“åº”
this.cache.set(cacheKey, response.data, cacheTTL);
```

### ä¼˜é›…çš„é”™è¯¯å¤„ç†

å®ç°å¥å£®çš„é”™è¯¯å¤„ç†ï¼Œä¿éšœç”¨æˆ·ä½“éªŒï¼š

```typescript
try {
  switch (request.params.name) {
    case "get_stock_overview": {
      // å®ç°...
    }
    // å…¶ä»–å·¥å…·...
    default:
      throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${request.params.name}`);
  }
} catch (error) {
  console.error(`[Error] Tool execution failed: ${error instanceof Error ? error.message : String(error)}`);
  if (error instanceof McpError) {
    throw error;
  }
  return {
    content: [{ type: "text", text: `Error: ${error instanceof Error ? error.message : String(error)}` }],
    isError: true
  };
}
```

---

## MCP èµ„æº

MCP èµ„æºè®©ä½ çš„æœåŠ¡å™¨æ— éœ€æ‰§è¡Œä»£ç å³å¯å‘ Cline æš´éœ²æ•°æ®ï¼Œé€‚åˆæä¾›æ–‡ä»¶ã€API å“åº”ã€æ•°æ®åº“è®°å½•ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

### æ·»åŠ èµ„æº

1. **å®šä¹‰èµ„æºï¼š**

```typescript
server.setRequestHandler(ListResourcesRequestSchema, async () => {
  return {
    resources: [
      {
        uri: "file:///project/readme.md",
        name: "Project README",
        mimeType: "text/markdown"
      }
    ]
  };
});
```

2. **å®ç°è¯»å–å¤„ç†å™¨ï¼š**

```typescript
server.setRequestHandler(ReadResourceRequestSchema, async (request) => {
  if (request.params.uri === "file:///project/readme.md") {
    const content = await fs.promises.readFile("/path/to/readme.md", "utf-8");
    return {
      contents: [
        {
          uri: request.params.uri,
          mimeType: "text/markdown",
          text: content
        }
      ]
    };
  }
  throw new Error("Resource not found");
});
```

èµ„æºè®© MCP æœåŠ¡å™¨æ›´å…·ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›ï¼ŒCline å¯ç›´æ¥å¼•ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨ç²˜è´´ã€‚è¯¦è§[å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.io/docs/concepts/resources)ã€‚

---

## å¸¸è§æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### API è®¤è¯å¤æ‚æ€§

**æŒ‘æˆ˜**ï¼šAPI è®¤è¯æ–¹å¼å¤šæ ·  
**è§£å†³æ–¹æ¡ˆ**ï¼š

- API key ç”¨ç¯å¢ƒå˜é‡é…ç½®
- OAuth éœ€å•ç‹¬è„šæœ¬è·å– refresh token
- æ•æ„Ÿ token å®‰å…¨å­˜å‚¨

```typescript
// ç”¨ç¯å¢ƒå˜é‡è®¤è¯
const API_KEY = process.env.ALPHAVANTAGE_API_KEY;
if (!API_KEY) {
  console.error("[Error] Missing ALPHAVANTAGE_API_KEY environment variable");
  process.exit(1);
}
// åˆå§‹åŒ– API å®¢æˆ·ç«¯
const apiClient = new AlphaAdvantageClient({ apiKey: API_KEY });
```

### API åŠŸèƒ½ç¼ºå¤±æˆ–æœ‰é™

**æŒ‘æˆ˜**ï¼šAPI å¯èƒ½ä¸æä¾›æ‰€æœ‰æ‰€éœ€åŠŸèƒ½  
**è§£å†³æ–¹æ¡ˆ**ï¼š

- ç”¨å¯ç”¨ç«¯ç‚¹å®ç°å…œåº•
- å¿…è¦æ—¶æ¨¡æ‹ŸåŠŸèƒ½
- è½¬æ¢ API æ•°æ®ä»¥æ»¡è¶³éœ€æ±‚

### API é™æµ

**æŒ‘æˆ˜**ï¼šå¤§å¤šæ•° API æœ‰é™æµï¼Œæ˜“å¯¼è‡´å¤±è´¥  
**è§£å†³æ–¹æ¡ˆ**ï¼š

- å®ç°é™æµ
- å¢åŠ æ™ºèƒ½ç¼“å­˜
- ä¼˜é›…é™çº§
- æ˜ç¡®æç¤ºé™æµé”™è¯¯

```typescript
if (this.requestsThisMinute >= 5) {
  console.error("[Rate Limit] Rate limit reached. Waiting for next minute...");
  return new Promise<void>((resolve) => {
    const remainingMs = 60 * 1000 - (Date.now() % (60 * 1000));
    setTimeout(resolve, remainingMs + 100); // åŠ  100ms ç¼“å†²
  });
}
```

---

## ç›¸å…³èµ„æº

- [MCP åè®®æ–‡æ¡£](https://github.com/modelcontextprotocol/mcp)
- [MCP SDK æ–‡æ¡£](https://github.com/modelcontextprotocol/sdk-js)
- [MCP æœåŠ¡å™¨ç¤ºä¾‹](https://github.com/modelcontextprotocol/servers)

